#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
#if($wma.isProfilePage())
	$cms.template("Top")
#end
<div class="customerBodyWrapper">
<div class="customerWide">

#set($visitorScore = $wma.leadScore)
#set($visitorLevel = $wma.profileLevel.level)
#set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
#############set($visitorLevelName = $wma.profileLevel.name)
###################################
## Uncomment to Preview template
###################################
##set($visitorScore = 100)
##set($visitorLevel = 0)
##set($visitorLevelName = "Master Level")
###################################
#if(!$visitorLevelName)
	#set($visitorLevelName = "Anonymous")
#end
#if(!$visitorLevel)
	#set($visitorLevel = 0)
#end
Your current profile level is $visitorLevel and your lead score is $visitorScore<br>

#foreach($level in $wma.getProfileLevels())
	#set($profileTrigger = $level.scoreTrigger)
	#set($profileLevel = $math.newInt($level.level))
	#set($profileLevelTag = $level.tag)
	#set($nextProfileLevel = $math.add($visitorLevel, 1))
	#foreach($nextLevel in $wma.profileLevels)
		#if($nextProfileLevel == $math.newInt($nextLevel.level))
			#set($nextProfileLevelTag = $nextLevel.tag)
			#set($nextProfileLevelName = $nextLevel.name)
			$codeDebug.log("Progressive Profile: The next Level is calculated by adding one to your profile level ($math.add($profileLevel, 1)) and then checking for a match between that ($nextProfileLevel) and an item in the array of profile levels ($math.newInt($nextLevel.level)) which gives us nextProfileLevelTag ($nextProfileLevelTag) and nextProfileLevelName ($nextProfileLevelName)")
		#end
	#end
	
	$codeDebug.log("Progressive Profile: $velocityCount. Level: $profileLevel - $profileLevelTag - Trigger: $profileTrigger - Next Level: $nextProfileLevel - $nextProfileLevelTag")
	#if($level.level > $visitorLevel)
		$codeDebug.log("Progressive Profile: This level ($level.level) is greater than your current level ($visitorLevel)")
		#if((($visitorScore >= $profileTrigger) || $cms.path == "/en/update") && (!$formDisplay || $formDisplay != "yes"))
			$codeDebug.log("Progressive Profile: Your lead score ($visitorScore) is greater than or equal to this level profile trigger ($profileTrigger) and the progressive profile form has not yet been displayed.")
			#if($wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag).size() == 0)
				$codeDebug.log("Progressive Profile: There are no unset fields for the next level.")
				#if($level.level == $visitorLevel)
					You have achieved the highest possible level.
				#else
					The $nextProfileLevelName level has been misconfigured. Please add fields to this level.
				#end
			#else
				#if($cms.path == "/en/update")
					Please provide the following information to view this content item.<br><br>
				#else
					To move to the $nextProfileLevelName level, submit the following information:<br><br>
				#end
				$codeDebug.log("Progressive Profile: I am getting unset fields for level $nextProfileLevel - $nextProfileLevelTag.")
			<script>
				function doAction(){
					
				  var selectedVals = '';
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
						
						  var selectCtrl = document.forms['profileForm'].elements["h_$field.tag"];
							for(var index=0; index < selectCtrl.length ; index++){
								if(selectCtrl[index].selected){
									selectedVals = selectedVals + selectCtrl[index].value + ',';
								}
							}
							if(selectedVals.length > 0 && selectedVals.charAt(selectedVals.length-1) == ',')
								selectedVals = selectedVals.substr(0,selectedVals.length-1);
							document.forms['profileForm'].${field.tag}.value = selectedVals;
							selectedVals = '';
						#end
					#end
				#end
				}
			</script>
				<table style="background-color:lightgreen;">
				<form name="profileForm" method="post" onsubmit="return doAction();" action="/s">
				<input type="hidden" name="action" value="submitProfile" />
				<input type="hidden" name="rurl" value="$req.fullURL" />
				#if($cms.path == "/en/update")
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($field.fieldType == "multiSelect")
							<input type="hidden" name="$field.tag" value="$field.tag"/>
						#end
					#end
				#end
				
				#if($subscription.error)
					$codeDebug.log("ERROR: $subscription.error has been found. $!subscription.errorCode: $!subscription.errorMessage - $!subscription.errorDetails")
					<div class="subscriptionError">
					DefaultMsg:<font color="red">$!subscription.errorMessage</font>
					</div>
					<div class="subscriptionError">
					ErrorCode:<font color="red">$!subscription.errorCode</font>
					</div>
					<div class="subscriptionError">
					ErrorDetails:<font color="red">$!subscription.errorDetails</font>
					</div><br>
				#end
				<input type="hidden" name="errorDestId" value="$cms.websiteSection.id" />
				#if($cms.content)
					<input type="hidden" name="errorContentId" value="$cms.content" />
				#end 
				#if($cms.path == "/en/update") ### This checks the PPL of the content item and displays fields based on that instead of the visitor level.
					#set($contentLevel = $wma.getProfileLevelForGatedContent())
					#foreach($field in $wma.getUnsetFieldsForGatedContent())
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
								#foreach($option in $field.options)
									<option value="$option.value">$option.label</option>
								#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#else
					#foreach($field in $wma.getUnsetFieldsForProfileLevel($nextProfileLevelTag))
						#if($string.indexOf($field.dataType, "date") != -1)
							<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
						#elseif($string.indexOf($field.dataType, "number") != -1)
							<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
						#elseif($field.fieldType == "select")
							<tr><td>$field.label : </td><td><select name="$field.tag"/>
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#elseif($field.fieldType == "multiSelect")
							<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
							#foreach($option in $field.options)
								<option value="$option.value">$option.label</option>
							#end
							</select>
							</td></tr>
						#else
							<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
						#end
					#end
					#if(!$wma.accountData)
						<tr><td>Account : </td><td>
						<select name="account"/>
							<option value="">none</option>
							#foreach($acts in $wma.accounts)
								<option value="$acts.getAccountId()">$acts.name</option>
							#end
						</select>
						</td></tr>
					#end
				#end
				<tr><td><input type="submit" value="Submit"/></td></tr>
				</form>
				#set($formDisplay = "yes")
				$codeDebug.log("Progressive Profile: The form has been displayed.")
			#end
			</table><br>
		#end
	#end
#end
#set($formDisplay = "")
$codeDebug.log("Progressive Profile: formDisplay is now set to ''.")
#*
<hr>
DEBUGGING<br>
<table>
#foreach($field in $wma.getUnsetFieldsForProfileLevel("tertiary")) 
	<tr><td>$velocityCount. $field.label - $field.fieldType - ($!field.ruleId)</td></tr>
	#if($string.indexOf($field.dataType, "date") != -1)
		<tr><td>$field.label : </td><td><input type="date" name="$field.tag"/></td></tr>
	#elseif($string.indexOf($field.dataType, "number") != -1)
		<tr><td>$field.label : </td><td><input type="integer" name="$field.tag"/></td></tr>
	#elseif($field.fieldType == "select")
		<tr><td>($!field.ruleId) $field.label : </td><td><select name="$field.tag"/>
		#foreach($option in $field.options)
			<option value="$option.value">$option.label ($!option.ruleId)</option>
		#end
		</select>
		</td></tr>
	#elseif($field.fieldType == "multiSelect")
		<tr><td>$field.label : </td><td><select multiple name="h_$field.tag" />
			#foreach($option in $field.options)
				<option value="$option.value">$option.label</option>
			#end
		</select>
		</td></tr>
	#else
		<tr><td>$field.label : </td><td><input type="text" name="$field.tag"/></td></tr>
	#end
#end
</table>
<hr>
*#
</div>
</div>
#if($wma.isProfilePage())
	$cms.template("Bottom")
#end
